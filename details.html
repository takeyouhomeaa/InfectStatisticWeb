<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <script src="js/echarts.min.js"></script>
    <style>
        ul{
            list-style: none;
        }
        td{
           text-align: center;
        }
        #t1 td{
            padding-top: 10px;
        }
        th{
            text-align: center;
        }

    </style>
</head>
<body>

<div class="container">
    <div class="jumbotron">
        <h2 id="province">省份名称</h2>
    </div>
</div>

<div class="container">
    <div class="panel panel-default">
       <table width=100%" id="t1">
           <tr>
               <td>
                   <ul>
                       <li id="currentConfirmed">XXXX</li>
                       <li>现有确诊</li>
                   </ul>
               </td>
               <td>
                   <ul>
                       <li id="confirmed">XXXX</li>
                       <li>累计确诊</li>
                   </ul>
               </td>
               <td>
                   <ul>
                       <li id="cure">XXXX</li>
                       <li>累计治愈</li>
                   </ul>
               </td>
               <td>
                   <ul>
                       <li id="death">XXXX</li>
                       <li>累计死亡</li>
                   </ul>
               </td>
           </tr>
       </table>
    </div>
</div>


<div class="container">
    <div id="main" class="panel panel-default" style="width: 100%;height:400px;"></div>
</div>
<!--<div class="container" style="text-align: center">-->
<!--    <button type="button" class="btn btn-default" id="">新增确诊趋势</button>-->
<!--    <button type="button" class="btn btn-default">累计确诊趋势</button>-->
<!--    <button type="button" class="btn btn-default">累计治愈/死亡</button>-->
<!--</div>-->

<div class="container">
    <div class="panel panel-default" id="cityData">
    </div>
</div>

<div>
    <br>
    <br>
</div>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="js/jquery-3.4.1.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="js/bootstrap.min.js"></script>

<script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
    $.getJSON ("data.json", function (res) {
        var url =  window.location.href;
        var str = url.split('?');
        var msg = str[1];

        console.log(msg,'msg')
        var processedData = [];
        res.forEach(item => {
            if(item.locationId == msg)
                processedData.push({
                    provinceName:item.provinceName,
                    statisticsData:item.statisticsData,
                    cities:item.cities
                })
            }
        );
        console.log(processedData,"pro");
        var cityData = [];
        processedData[0].cities.forEach(item=>{
            cityData.push({
                name:item.cityName + '市',
                value:item.currentConfirmedCount,
                confirmedCount:item.confirmedCount,
                suspectedCount:item.suspectedCount,
                curedCount:item.curedCount,
                deadCount:item.deadCount,
            })
        })


        div=document.getElementById('cityData');
        var tab='<table border=1 width=100%">';
        tab+='<tr>' +
            '<th>城市</th>' +
            '<th>现今确诊人数</th>' +
            '<th>累计确诊人数</th>' +
            '<th>疑似人数</th>' +
            '<th>治愈人数</th>' +
            '<th>死亡人数</th>' +
            '</tr>';
        var currentConfirmed = 0;
        var confirmed = 0;
        var cure = 0;
        var death = 0;
        for(i = 0;i<processedData[0].cities.length;i++) {
            tab += '<tr>'
            tab += "<td>" + processedData[0].cities[i].cityName + "</td>";
            tab += "<td>" + processedData[0].cities[i].currentConfirmedCount + "</td>";
            tab += "<td>" + processedData[0].cities[i].confirmedCount + "</td>";
            tab += "<td>" + processedData[0].cities[i].suspectedCount + "</td>";
            tab += "<td>" + processedData[0].cities[i].curedCount + "</td>";
            tab += "<td>" + processedData[0].cities[i].deadCount + "</td>";
            tab += '</tr>';
            currentConfirmed += processedData[0].cities[i].currentConfirmedCount;
            confirmed += processedData[0].cities[i].confirmedCount;
            cure += processedData[0].cities[i].curedCount;
            death += processedData[0].cities[i].deadCount;
        }
        tab+='</table>';
        div.innerHTML=tab;

        document.getElementById('province').innerText=processedData[0].provinceName;
        document.getElementById('currentConfirmed').innerText=currentConfirmed;
        document.getElementById('confirmed').innerText=confirmed;
        document.getElementById('cure').innerText=cure;
        document.getElementById('death').innerText=death;
        var mapName = 'json/' + msg + '.json';
        $.get(mapName, function (json) {
            echarts.registerMap(msg, json);
            var myChart = echarts.init(document.getElementById('main'));
            console.log(cityData,"city");
            myChart.setOption ({
                //标题设置

                title: {
                    text: 'ECharts 入门示例',
                    subtext: '当前现有确诊病例数，排除治愈、死亡',
                    left:'center',
                },
                series: [{
                    type:'map',
                    map:msg,
                    label:{
                        show:true,
                    },
                    data:cityData
                }],
                tooltip:{
                    formatter: function (params) {
                        return `地区：${params.name}<br/>确诊：${params.value|| 0}人<br/>
                        治愈：${(params.data && params.data.curedCount) || 0}人<br/>死亡：${params.data?.deadCount || 0}人<br/>`;
                    }
                },
                visualMap:[
                    {
                        pieces:[
                            { gt: 10000 }, // (10000, Infinity]
                            { gt: 1000, lte: 9999 }, // (1000, 9999]
                            { gt: 100, lte: 999 }, // (100, 999]
                            { gt: 10, lte: 99 }, // (10, 99]
                            { gt: 1, lte: 9 }, // (0, 9]
                            { value:0}
                        ],
                        inRange: {
                            color: ['#ffffff','#fdebcf', '#f59e83', '#e55a4e', '#cb2a2f', '#811c24']
                        }
                    }
                ],
                backgroundColor:'#f7f7f7',
            });
        });
    })
</script>

</body>
</html>